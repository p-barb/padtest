<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>padtest.model.model &mdash; padtest 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            padtest
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../geometry.html">Geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../materials.html">Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test.html">Foundation tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">padtest</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">padtest.model.model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for padtest.model.model</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">padtest.material.plate</span> <span class="kn">import</span> <span class="n">PlateMaterial</span>
<span class="kn">from</span> <span class="nn">padtest.material.soil</span> <span class="kn">import</span> <span class="n">SoilMaterial</span>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for models.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_i : Server</span>
<span class="sd">        Plaxis Input Application remote sripting server.</span>
<span class="sd">    g_i : PlxProxyGlobalObject</span>
<span class="sd">        Global object of the current open Plaxis model in Input.</span>
<span class="sd">    g_o : PlxProxyGlobalObject</span>
<span class="sd">        Global object of the current open Plaxis model in Output.</span>
<span class="sd">    model_type : str</span>
<span class="sd">        Model type: &#39;axisymmetry&#39; or &#39;planestrain&#39;.</span>
<span class="sd">    element_type : str</span>
<span class="sd">        Element type: &#39;6-Noded&#39; or &#39;15-Noded&#39;.</span>
<span class="sd">    title : str</span>
<span class="sd">        Model title in Plaxis.</span>
<span class="sd">    comments : str</span>
<span class="sd">        Model comments in Plaxis.</span>
<span class="sd">    soil : soil : dict, list</span>
<span class="sd">        Dictionary with the material properties or list of</span>
<span class="sd">        dictionaries.</span>
<span class="sd">    fill : fill : dict, list</span>
<span class="sd">        Dictionary with the fill properties or list of dictionaries.</span>
<span class="sd">    ratchetting_material  : dict, None</span>
<span class="sd">        Dictionary with the material properties after ratchetting.</span>
<span class="sd">    ratchetting_threshold : float, None</span>
<span class="sd">        Upwards displacement threshold that when surpassed by any</span>
<span class="sd">        output location under the foundation the material under</span>
<span class="sd">        it is replaced by the ratchetting material.</span>
<span class="sd">    mesh_density : float</span>
<span class="sd">        Mesh density.</span>
<span class="sd">    locations : array-like</span>
<span class="sd">        Location of output points in the foundation bottom, measured</span>
<span class="sd">        as [0, 1] where 0 is the center of the foundation and 1 the</span>
<span class="sd">        edge.</span>
<span class="sd">    excavation : bool</span>
<span class="sd">        If True in models with fill, the excavation and fill</span>
<span class="sd">        processes are included in the initial phases.</span>
<span class="sd">    deformation_boundary_condition : dict, None, optional</span>
<span class="sd">        Deformation boundary conditions of the model. If None the</span>
<span class="sd">        default setting is adopted. Dictionary with keys `XMin`,</span>
<span class="sd">        `XMax`, `YMin` and `YMax`, with supported values</span>
<span class="sd">        &#39;Free&#39;,  &#39;Normally fixed&#39;,  &#39;Horizontally fixed&#39;,</span>
<span class="sd">        &#39;Vertically fixed&#39; and &#39;Fully fixed&#39;. By default None.</span>
<span class="sd">    dynamic_boundary_condtions : dict, None, optional</span>
<span class="sd">        Dynamic boundary conditions of the model used in dynamic load</span>
<span class="sd">        tests. If None the default setting is adopted. Dictionary</span>
<span class="sd">        with keys `XMin`, `XMax`, `YMin` and `YMax`, with supported</span>
<span class="sd">        values &#39;None&#39; and &#39;Viscous&#39;. By default None.</span>
<span class="sd">    shake_boundary_condtions : dict, None, optional</span>
<span class="sd">        Dynamic boundary conditions of the model used in base shake</span>
<span class="sd">        tests. If None the default setting is adopted. Dictionary</span>
<span class="sd">        with keys `XMin`, `XMax`, `YMin` and `YMax`, with supported</span>
<span class="sd">        values &#39;None&#39;, &#39;Viscous&#39;, &#39;Free-field&#39; and &#39;Compliant base&#39;.</span>
<span class="sd">        By default None.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    build()</span>
<span class="sd">        Builds the model in Plaxis.</span>
<span class="sd">    regen(s_i, g_i, g_o, test=False) : </span>
<span class="sd">        Regenerates the model in Plaxis. Optinoally it recalculates</span>
<span class="sd">        previous load tests.</span>
<span class="sd">    save(filename)</span>
<span class="sd">        Saves model to file. Plaxis objects cannot be stored, only</span>
<span class="sd">        input properties and results. When loaded, the model can</span>
<span class="sd">        be regenerated with &lt;regen&gt; method.</span>
<span class="sd">    load(filename)</span>
<span class="sd">        Loads saved test.</span>
<span class="sd">    failure_test(testid, load, max_load=[np.inf, np.inf, np.inf], load_factor=2, load_increment=[0, 0, 0], qsurf=None, start_from=&#39;construction&#39;, delete_fail=True)</span>
<span class="sd">        Test the foundation until the model does not converge.</span>
<span class="sd">    load_test(testid, load, start_from=&#39;construction&#39;, qsurf=None, delete_fail=True)</span>
<span class="sd">        Conducts a load test in the model.</span>
<span class="sd">    safety_test(testid, start_from, test=&#39;incremental&#39;, SumMsf=None, Msf=0.1, qsurf=None, delete_fail=True)</span>
<span class="sd">        Conducts a safety test on the model.</span>
<span class="sd">    dynamic_test(testid, time, load, start_from=&#39;construction&#39;, nsubstep=10, qsurf=None, delete_fail=True)</span>
<span class="sd">        Apply a dynamic load to the foundation.</span>
<span class="sd">    shake_test(testid, time, acceleration, start_from=&#39;construction&#39;, qsurf=None, nsubstep=10, delete_fail=True)</span>
<span class="sd">        Apply a displacement time history at the model base.</span>
<span class="sd">    delete_test( testid, delete_fail=True) </span>
<span class="sd">        Deletes a test from the model.</span>
<span class="sd">    plot_test(testid, force=None, displacement=None, phase=None, location=None, compression_positive=True, pullout_positive=False, reset_start=False, legend=False, xlim=None, ylim=None, figsize=(4, 3))</span>
<span class="sd">        Plots test results.</span>
<span class="sd">    plot_safety_test(testid, location=None, pullout_positive=False, reset_start=False, legend=False, figsize=(6, 4))</span>
<span class="sd">        Plots safety test.</span>
<span class="sd">    plot_dynamic_test(testid, displacement=None, force=None, location=None, compression_positive=True, pullout_positive=False, xlim=None, ylim=None, legend=False, figsize=(8, 2))</span>
<span class="sd">        Plot dynamic test resutls versus time.</span>
<span class="sd">    plot_shake_test(self, testid, displacement=None, acceleration=None, location=None, pullout_positive=False, xlim=None, ylim=None, legend=False, figsize=(8, 2))</span>
<span class="sd">        Plot shake test results versus time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_i</span><span class="p">,</span> <span class="n">g_i</span><span class="p">,</span> <span class="n">g_o</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">element_type</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                 <span class="n">comments</span><span class="p">,</span> <span class="n">soil</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">ratchetting_material</span><span class="p">,</span>
                 <span class="n">ratchetting_threshold</span><span class="p">,</span> <span class="n">mesh_density</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">excavation</span><span class="p">,</span>
                 <span class="n">deformation_boundary_condition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dynamic_boundary_condtions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">shake_boundary_condtions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundary_interface</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Init method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s_i : Server</span>
<span class="sd">            Plaxis Input Application remote sripting server.</span>
<span class="sd">        g_i : PlxProxyGlobalObject</span>
<span class="sd">            Global object of the current open Plaxis model in Input.</span>
<span class="sd">        g_o : PlxProxyGlobalObject</span>
<span class="sd">            Global object of the current open Plaxis model in Output.</span>
<span class="sd">        model_type : str</span>
<span class="sd">            Model type: &#39;axisymmetry&#39; or &#39;planestrain&#39;.</span>
<span class="sd">        element_type : str</span>
<span class="sd">            Element type: &#39;6-Noded&#39; or &#39;15-Noded&#39;.</span>
<span class="sd">        title : str</span>
<span class="sd">            Model title in Plaxis.</span>
<span class="sd">        comments : str</span>
<span class="sd">            Model comments in Plaxis.</span>
<span class="sd">        soil : soil : dict, list</span>
<span class="sd">            Dictionary with the material properties or list of</span>
<span class="sd">            dictionaries.</span>
<span class="sd">        fill : fill : dict, list</span>
<span class="sd">            Dictionary with the fill properties or list of dictionaries.</span>
<span class="sd">        ratchetting_material  : dict, None</span>
<span class="sd">            Dictionary with the material properties after ratchetting.</span>
<span class="sd">        ratchetting_threshold : float</span>
<span class="sd">            Upwards displacement threshold that when surpassed by any</span>
<span class="sd">            output location under the foundation the material under</span>
<span class="sd">            it is replaced by the ratchetting material.</span>
<span class="sd">        mesh_density : float</span>
<span class="sd">            Mesh density.</span>
<span class="sd">        locations : array-like</span>
<span class="sd">            (nloc, 1) location of output points in the foundation</span>
<span class="sd">            bottom, measured as [0, 1] where 0 is the center of the</span>
<span class="sd">            foundation and 1 the edge.</span>
<span class="sd">        excavation : bool</span>
<span class="sd">            If True in models with fill, the excavation and fill</span>
<span class="sd">            processes are included in the initial phases.</span>
<span class="sd">        deformation_boundary_condition : dict, None, optional</span>
<span class="sd">            Deformation boundary conditions of the model. If None the</span>
<span class="sd">            default setting is adopted. Dictionary with keys `XMin`,</span>
<span class="sd">            `XMax`, `YMin` and `YMax`, with supported values</span>
<span class="sd">            &#39;Free&#39;,  &#39;Normally fixed&#39;,  &#39;Horizontally fixed&#39;,</span>
<span class="sd">            &#39;Vertically fixed&#39; and &#39;Fully fixed&#39;. By default None.</span>
<span class="sd">        dynamic_boundary_condtions : dict, None, optional</span>
<span class="sd">            Dynamic boundary conditions of the model used in dynamic load</span>
<span class="sd">            tests. If None the default setting is adopted. Dictionary</span>
<span class="sd">            with keys `XMin`, `XMax`, `YMin` and `YMax`, with supported</span>
<span class="sd">            values &#39;None&#39; and &#39;Viscous&#39;. By default None.</span>
<span class="sd">        shake_boundary_condtions : dict, None, optional</span>
<span class="sd">            Dynamic boundary conditions of the model used in base shake</span>
<span class="sd">            tests. If None the default setting is adopted. Dictionary</span>
<span class="sd">            with keys `XMin`, `XMax`, `YMin` and `YMax`, with supported</span>
<span class="sd">            values &#39;None&#39;, &#39;Viscous&#39;, &#39;Free-field&#39; and &#39;Compliant base&#39;.</span>
<span class="sd">            By default None.</span>
<span class="sd">        boundary_interface : bool, optional</span>
<span class="sd">            Include boundary interfaces needed for a base shake test.</span>
<span class="sd">            This requires a much denser mesh and more computationally</span>
<span class="sd">            demanding models. By default False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s_i</span> <span class="o">=</span> <span class="n">s_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span> <span class="o">=</span> <span class="n">g_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span> <span class="o">=</span> <span class="n">g_o</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># inputs required to create the materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plate_material</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># inputs required to create the materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material_plx</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Plaxis objects of the materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plate_material_plx</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Plaxis objects of the materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_model_settings</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">element_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_strata_materials</span><span class="p">(</span><span class="n">soil</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_fill_materials</span><span class="p">(</span><span class="n">fill</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ratchetting_material</span><span class="p">(</span><span class="n">ratchetting_material</span><span class="p">,</span> <span class="n">ratchetting_threshold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_mesh</span><span class="p">(</span><span class="n">mesh_density</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_output</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_boundary_conditions</span><span class="p">(</span><span class="n">deformation_boundary_condition</span><span class="p">,</span> <span class="n">dynamic_boundary_condtions</span><span class="p">,</span> <span class="n">shake_boundary_condtions</span><span class="p">,</span> <span class="n">boundary_interface</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_excavation</span> <span class="o">=</span> <span class="n">excavation</span>
    
    <span class="c1">#===================================================================</span>
    <span class="c1"># PRIVATE METHODS</span>
    <span class="c1">#===================================================================   </span>
    <span class="k">def</span> <span class="nf">_init_model_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">element_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize model settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        title : str, None</span>
<span class="sd">            Model title in Plaxis.</span>
<span class="sd">        comments : str, None</span>
<span class="sd">            Model comments in Plaxis.</span>
<span class="sd">        model_type : str</span>
<span class="sd">            Model type: `axisymmetry` or `planestrain`.</span>
<span class="sd">        element_type : str</span>
<span class="sd">            Element type: &#39;6-Noded&#39; or &#39;15-Noded&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comments</span> <span class="o">=</span> <span class="n">comments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_element_type</span> <span class="o">=</span> <span class="n">element_type</span>

    <span class="k">def</span> <span class="nf">_init_strata_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soil</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the materials for the stratigraphy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        soil : dict, list</span>
<span class="sd">            Dictionary with the material properties or list of</span>
<span class="sd">            dictionaries.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Numer of provided materials does not match the number of</span>
<span class="sd">            soil layers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">soil</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">soil</span> <span class="o">=</span> <span class="p">[</span><span class="n">soil</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">soil</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nstrata</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A material must be specified for each of the </span><span class="si">{:.0f}</span><span class="s2"> soil layers.&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nstrata</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">strata</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">soil</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;strata_</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">strata</span>

    <span class="k">def</span> <span class="nf">_init_fill_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes fill materials.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fill : dict, list</span>
<span class="sd">            Dictionary with the fill properties or list of dictionaries.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            No fill material provided.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Numer of provided fill materials does not match the number</span>
<span class="sd">            of fill layers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Fill material must be specified.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="p">[</span><span class="n">fill</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fill</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nfill</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A material must be specified for each of the </span><span class="si">{:.0f}</span><span class="s2"> fill layers.&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nfill</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fill</span><span class="p">):</span>    
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;fill_</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span>

    <span class="k">def</span> <span class="nf">_init_ratchetting_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratchetting_material</span><span class="p">,</span> <span class="n">ratchetting_threshold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the ratchetting material.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ratchetting_material  : dict</span>
<span class="sd">            Dictionary with the material properties after ratchetting.</span>
<span class="sd">        ratchetting_threshold : float</span>
<span class="sd">            Upwards displacement threshold that when surpassed by any</span>
<span class="sd">            output location under the foundation the material under</span>
<span class="sd">            it is replaced by the ratchetting material.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Ratchetting material missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">ratchetting_material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The post ratchetting material must be specified.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material</span><span class="p">[</span><span class="s1">&#39;ratchetting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratchetting_material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting_threshold</span> <span class="o">=</span> <span class="n">ratchetting_threshold</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_init_foundation_material</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="nf">_init_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_density</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes mesh settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh_density : float</span>
<span class="sd">            Mesh density.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_density</span> <span class="o">=</span> <span class="n">mesh_density</span>

    <span class="k">def</span> <span class="nf">_init_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes output.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        locations : array-like</span>
<span class="sd">            (nloc, 1) location of output points in the foundation</span>
<span class="sd">            bottom, measured as [0, 1] where 0 is the center of the</span>
<span class="sd">            foundation and 1 the edge.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="s1">&#39;previous&#39;</span><span class="p">,</span> <span class="s1">&#39;plx id&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;previous plx id&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;sumMstage&#39;</span><span class="p">,</span> <span class="s1">&#39;SumMsf&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;qy0&#39;</span><span class="p">,</span> <span class="s1">&#39;qy1&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;qx&#39;</span><span class="p">,</span> <span class="s1">&#39;agx&#39;</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;Fy target&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx target&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;M target&#39;</span><span class="p">,</span> <span class="s1">&#39;ratchetting&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="n">results_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">locations</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">locations</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b2</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">:</span>
            <span class="n">locations</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">locations</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_location</span> <span class="o">=</span> <span class="n">locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_location_xcoord</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_location</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_point</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_init_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deformation_boundary_condition</span><span class="p">,</span>
                                  <span class="n">dynamic_boundary_condtions</span><span class="p">,</span>
                                  <span class="n">shake_boundary_condtions</span><span class="p">,</span> <span class="n">boundary_interface</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the boundary conditions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deformation_boundary_condition : dict, None</span>
<span class="sd">            Deformation boundary conditions of the model. If None the</span>
<span class="sd">            default setting is adopted. Dictionary with keys `XMin`,</span>
<span class="sd">            `XMax`, `YMin` and `YMax`, with supported values</span>
<span class="sd">            &#39;Free&#39;,  &#39;Normally fixed&#39;,  &#39;Horizontally fixed&#39;,</span>
<span class="sd">            &#39;Vertically fixed&#39; and &#39;Fully fixed&#39;. </span>
<span class="sd">        dynamic_boundary_condtions : dict, None</span>
<span class="sd">            Dynamic boundary conditions of the model used in dynamic load</span>
<span class="sd">            tests. If None the default setting is adopted. Dictionary</span>
<span class="sd">            with keys `XMin`, `XMax`, `YMin` and `YMax`, with supported</span>
<span class="sd">            values &#39;None&#39; and &#39;Viscous&#39;.</span>
<span class="sd">        shake_boundary_condtions : dict, None</span>
<span class="sd">            Dynamic boundary conditions of the model used in base shake</span>
<span class="sd">            tests. If None the default setting is adopted. Dictionary</span>
<span class="sd">            with keys `XMin`, `XMax`, `YMin` and `YMax`, with supported</span>
<span class="sd">            values &#39;None&#39;, &#39;Viscous&#39;, &#39;Free-field&#39; and &#39;Compliant base&#39;.</span>
<span class="sd">        boundary_interface : bool</span>
<span class="sd">            Include boundary interfaces needed for a base shake test.</span>
<span class="sd">            This requires a much denser mesh and more computationally</span>
<span class="sd">            demanding models.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Wrong deformation boundary id.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Unsuported deformation boundary condition.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Wrong dynamic boundary id.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Unsuported dynamic boundary condition.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Wrong shake boundary id.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Unsuported shake boundary condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Deformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_DEFORMATION_BC</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deformation_boundary_condition</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">supported</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Free&quot;</span><span class="p">,</span>  <span class="s2">&quot;Normally fixed&quot;</span><span class="p">,</span>  <span class="s2">&quot;Horizontally fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;Vertically fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;Fully fixed&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">deformation_boundary_condition</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">boundary</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Boundary &lt;</span><span class="si">{}</span><span class="s2">&gt; not supported in deformation &quot;</span>
                           <span class="s2">&quot;boundary conditions. Supported values are: &quot;</span>
                           <span class="s2">&quot;&#39;XMin&#39;, &#39;XMax&#39;, &#39;YMin&#39; and &#39;YMax&#39;.&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">deformation_boundary_condition</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Deformation boundary condition &lt;</span><span class="si">{}</span><span class="s2">&gt; not supported. &quot;</span>
                           <span class="s2">&quot;Suported values are: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deformation_boundary_condition</span><span class="p">[</span><span class="n">boundary</span><span class="p">],</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="o">=</span> <span class="n">deformation_boundary_condition</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span>
        
        <span class="c1"># Dynamic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_DYNAMIC_BC</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynamic_boundary_condtions</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">supported</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>  <span class="s2">&quot;Viscous&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">dynamic_boundary_condtions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">boundary</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Boundary &lt;</span><span class="si">{}</span><span class="s2">&gt; not supported in dynamic &quot;</span>
                           <span class="s2">&quot;boundary conditions. Supported values are: &quot;</span>
                           <span class="s2">&quot;&#39;XMin&#39;, &#39;XMax&#39;, &#39;YMin&#39; and &#39;YMax&#39;.&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dynamic_boundary_condtions</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Dynamic boundary condition &lt;</span><span class="si">{}</span><span class="s2">&gt; not supported. &quot;</span>
                           <span class="s2">&quot;Suported values are: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dynamic_boundary_condtions</span><span class="p">[</span><span class="n">boundary</span><span class="p">],</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamic_boundary_condtions</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span>

        <span class="c1"># Shake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_SHAKE_BC</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shake_boundary_condtions</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">supported</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>  <span class="s2">&quot;Viscous&quot;</span><span class="p">,</span> <span class="s2">&quot;Free-field&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">shake_boundary_condtions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">boundary</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Boundary &lt;</span><span class="si">{}</span><span class="s2">&gt; not supported in shake &quot;</span>
                           <span class="s2">&quot;boundary conditions. Supported values are: &quot;</span>
                           <span class="s2">&quot;&#39;XMin&#39;, &#39;XMax&#39;, &#39;YMin&#39; and &#39;YMax&#39;.&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shake_boundary_condtions</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Shake boundary condition &lt;</span><span class="si">{}</span><span class="s2">&gt; not supported. &quot;</span>
                           <span class="s2">&quot;Suported values are: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shake_boundary_condtions</span><span class="p">[</span><span class="n">boundary</span><span class="p">],</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span> <span class="o">=</span> <span class="n">shake_boundary_condtions</span><span class="p">[</span><span class="n">boundary</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface_flag</span> <span class="o">=</span> <span class="n">boundary_interface</span>

    <span class="k">def</span> <span class="nf">_set_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General model settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s_i</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">SoilContour</span><span class="o">.</span><span class="n">initializerectangular</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">setproperties</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_title</span><span class="p">,</span>
                                <span class="s2">&quot;Comments&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_comments</span><span class="p">,</span>
                                <span class="s2">&quot;ModelType&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span><span class="p">,</span>
                                <span class="s2">&quot;ElementType&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_element_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds model in Plaxis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure_soil</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_polygons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polygons</span><span class="p">:</span>
            <span class="n">struct_poly</span><span class="p">,</span> <span class="n">struct_soil</span><span class="p">,</span> <span class="n">phase_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">add_2_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct_poly</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_structure_soil</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct_soil</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phase_polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase_poly</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_wt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">gotoflow</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waterlevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">waterlevel</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_global_wt</span><span class="p">],</span>
                                                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_width</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_global_wt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_waterlevel</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">gotostructures</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_plx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_footing_plx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_column_plx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_footing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_footing_plx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_footing</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_interfaces</span><span class="o">.</span><span class="n">build_geometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">neginterface</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">neginterface</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">neginterface</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">_acceleration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">linedispl</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
    <span class="k">def</span> <span class="nf">_build_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates soil and plate materials in the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">matid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material_plx</span><span class="p">[</span><span class="n">matid</span><span class="p">]</span> <span class="o">=</span> <span class="n">SoilMaterial</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">matid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material</span><span class="p">[</span><span class="n">matid</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">matid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plate_material</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plate_material_plx</span><span class="p">[</span><span class="n">matid</span><span class="p">]</span> <span class="o">=</span> <span class="n">PlateMaterial</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">matid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plate_material</span><span class="p">[</span><span class="n">matid</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interfaces</span><span class="o">.</span><span class="n">build_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_build_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_build_surface_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="nf">_build_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mesh the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">gotomesh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mesh_density</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_initial_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the initial phases to the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excavation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initial_phases_with_excavation</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excavation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initial_phases_no_excavation</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initial_phases_no_excavation</span><span class="p">()</span>
                 
    <span class="k">def</span> <span class="nf">_initial_phases_with_excavation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the initial, excavation and construction phases in a</span>
<span class="sd">        model with excavation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">gotostages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_phase</span> <span class="o">=</span> <span class="s1">&#39;construction&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_phase_idx</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nphase</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c1"># Initial phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;Initial Phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">InitialPhase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">InitialPhase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_deformation_boundary_conditions</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_footing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_footing_plx</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_column_plx</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excavation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;strata_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;strata_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;strata_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Excavation phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;excavation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">InitialPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;excavation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="s2">&quot;excavation&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;excavation&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_excavation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span><span class="p">[</span><span class="n">poly_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>

        <span class="c1"># construction phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;construction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;excavation&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;construction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="s2">&quot;construction&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;construction&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_activate_foundation</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span><span class="p">[</span><span class="n">poly_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;fill_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_interfaces</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_initial_phases_no_excavation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds the initial phase to a model without excavation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fill : bool</span>
<span class="sd">            Sets excavated material to fill. By default False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">gotostages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_phase</span> <span class="o">=</span> <span class="s1">&#39;construction&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_phase_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nphase</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Initial phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;Initial Phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">InitialPhase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">InitialPhase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_deformation_boundary_conditions</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_activate_foundation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;strata_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;strata_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_interfaces</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fill</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">strata_idx</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;fill_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strata_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># construction phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;construction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;Initial Phase&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;construction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="s2">&quot;construction&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="s1">&#39;construction&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g_i</span><span class="p">,</span> <span class="n">soil_idx</span><span class="p">,</span> <span class="n">phase_idx</span><span class="p">,</span> <span class="n">material</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assings a soil material to a polygon in a given phase. g_i</span>
<span class="sd">        must be passed as an argument so it is in the variable space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        g_i : PlxProxyGlobalObject</span>
<span class="sd">            Global object of the current open Plaxis model in Input.</span>
<span class="sd">        soil_idx : int</span>
<span class="sd">            Numer that identifies the soil, e.g. Soil_#.</span>
<span class="sd">        phase_idx : int</span>
<span class="sd">            Index of the phase in the self._g_i.phases list.</span>
<span class="sd">        material : str</span>
<span class="sd">            Material key in the soil material dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">material</span> <span class="o">=</span> <span class="s2">&quot;self._soil_material_plx[&#39;</span><span class="si">{}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;self._g_i.setmaterial(self._g_i.Soil_</span><span class="si">{:.0f}</span><span class="s2">, self._g_i.phases[</span><span class="si">{:.0f}</span><span class="s2">], </span><span class="si">{}</span><span class="s2">)&quot;</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">soil_idx</span><span class="p">,</span> <span class="n">phase_idx</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_activate_foundation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_output_precalc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select output points before calcualtion. Used for points in</span>
<span class="sd">        the soil.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_output_postcalc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select output points before calcualtion. Used for points in</span>
<span class="sd">        structural elements.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="nf">_calculate_initial_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computs initial phases.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Phase calculation error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">:</span>
            <span class="n">phaseid</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phase</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_output_postcalc</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nstep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span><span class="o">.</span><span class="n">Steps</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        
        <span class="n">sumMstage</span><span class="p">,</span> <span class="n">Uy</span><span class="p">,</span> <span class="n">Ux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_initial_phase_results</span><span class="p">(</span><span class="n">phaseid</span><span class="p">,</span> <span class="n">nstep</span><span class="p">)</span>
        
        <span class="c1"># ad results to dataframe</span>
        <span class="k">for</span> <span class="n">locidx</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_point</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;test&#39;</span><span class="p">:[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;phase&#39;</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;previous&#39;</span><span class="p">:[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nstep</span><span class="p">),</span>
                               <span class="s1">&#39;plx id&#39;</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;previous plx id&#39;</span><span class="p">:[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nstep</span><span class="p">,</span> <span class="n">nstep</span><span class="p">),</span>
                               <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;sumMstage&#39;</span><span class="p">:</span><span class="n">sumMstage</span><span class="p">,</span> 
                               <span class="s1">&#39;SumMsf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;uy&#39;</span><span class="p">:</span> <span class="n">Uy</span><span class="p">[</span><span class="n">locidx</span><span class="p">,</span> <span class="p">:],</span>
                               <span class="s1">&#39;ux&#39;</span><span class="p">:</span> <span class="n">Ux</span><span class="p">[</span><span class="n">locidx</span><span class="p">,</span> <span class="p">:],</span>
                               <span class="s1">&#39;Fy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;Fx&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;qy0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;qy1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;qx&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;agx&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;agy&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;Fy target&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;Fx target&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>
                               <span class="s1">&#39;M target&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">,</span>                            
                               <span class="s1">&#39;ratchetting&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">nstep</span><span class="p">})</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="n">df</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">,</span> <span class="n">df</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_extract_initial_phase_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">sumMstage</span><span class="p">,</span> <span class="n">Uy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts results form the output of the initial phases calculation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id.</span>
<span class="sd">        sumMstage : np.ndarray</span>
<span class="sd">            (nstep, 1) sumMstage of the phase.</span>
<span class="sd">        Uy : np.ndarray</span>
<span class="sd">            (nstep, nloc) displacement at the output locations.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            (nstep, 1) sumMstage of the phase.</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            (nstep, nloc) displacement at the output locations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_load_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format input load.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        load : array-like, numeric</span>
<span class="sd">            (3,) array-like with (Fy, Fx, M) applied to the foundaiton.</span>
<span class="sd">            Numeric value is assumed as Fy, returning (Fy, 0, 0).</span>
<span class="sd">            Symmetric foundations only allow for numeric values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            (3,)  (Fy, Fx, M) applied to the foundaiton.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Non-numeric load value in symmetric foundation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">load</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>  <span class="ow">and</span> <span class="n">load</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Symmetric models only allow for vertical loads.&#39;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">load</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">load</span>

    <span class="k">def</span> <span class="nf">_get_phase_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the start or end load of a calcualted phase from</span>
<span class="sd">        the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id</span>
<span class="sd">        when : str</span>
<span class="sd">            &#39;start&#39; or &#39;end&#39;.</span>
<span class="sd">        target : bool, optinal</span>
<span class="sd">            Get target load values, instead of applied load inferred</span>
<span class="sd">            from Plaxis output. By default False.  </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            (3,) load applied at the end of the phase (Fy, Fx, M).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">phaseid</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">when</span><span class="o">==</span><span class="s1">&#39;end&#39;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">when</span><span class="o">==</span><span class="s1">&#39;start&#39;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">load</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;Fy target&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;Fx target&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;M target&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">load</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_deformation_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets deformation conditions in the current phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Deformations</span><span class="o">.</span><span class="n">BoundaryXMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span><span class="p">[</span><span class="s1">&#39;XMin&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Deformations</span><span class="o">.</span><span class="n">BoundaryXMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span><span class="p">[</span><span class="s1">&#39;XMax&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Deformations</span><span class="o">.</span><span class="n">BoundaryYMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span><span class="p">[</span><span class="s1">&#39;YMin&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Deformations</span><span class="o">.</span><span class="n">BoundaryYMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_deformation_bc</span><span class="p">[</span><span class="s1">&#39;YMax&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_dynamic_test_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">nsubstep</span><span class="p">,</span> <span class="n">shake</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up a dynamic design phase in the model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        time : np-array</span>
<span class="sd">            (nt,) time array.</span>
<span class="sd">        start_phaseid : str</span>
<span class="sd">            Id of the test start phase.</span>
<span class="sd">        nsubstep : int</span>
<span class="sd">            Substests in each time step.</span>
<span class="sd">        shake : bool</span>
<span class="sd">            True if base shake test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">start_phaseid</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">DeformCalcType</span><span class="p">,</span> <span class="s2">&quot;Dynamic&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">TimeIntervalSeconds</span><span class="p">,</span> <span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">UseDefaultIterationParams</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">TimeStepDetermType</span><span class="p">,</span> <span class="s2">&quot;Manual&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">MaxSteps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">SubSteps</span><span class="p">,</span> <span class="n">nsubstep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">shake</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryXMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span><span class="p">[</span><span class="s1">&#39;XMin&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryXMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span><span class="p">[</span><span class="s1">&#39;XMax&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryYMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span><span class="p">[</span><span class="s1">&#39;YMax&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryYMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_shake_bc</span><span class="p">[</span><span class="s1">&#39;YMin&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryXMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span><span class="p">[</span><span class="s1">&#39;XMin&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryXMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span><span class="p">[</span><span class="s1">&#39;XMax&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryYMax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span><span class="p">[</span><span class="s1">&#39;YMax&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">BoundaryYMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_bc</span><span class="p">[</span><span class="s1">&#39;YMin&#39;</span><span class="p">])</span>
        
    <span class="k">def</span> <span class="nf">_get_start_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the phase id to be used as the start conditions for</span>
<span class="sd">        a new load test.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : str, tuple</span>
<span class="sd">            &#39;construction&#39;, &#39;excavation&#39;, Plaxis phase id or test id</span>
<span class="sd">            used as the start conditions for a new test. If a test with</span>
<span class="sd">            multiple stages is requested, the last test phase is</span>
<span class="sd">            selected. Specific test stages are selected by providing a</span>
<span class="sd">            tuple (test id, stage number), where the phase number is an</span>
<span class="sd">            integer starting from 0. Failure and safety tests cannot be</span>
<span class="sd">            used start configurations.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Phase id.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Start phase or test not available.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Failure or safety test requested as start configurations.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Start test not available.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Failure or safety test requested as start configurations.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Wrong stage input type. </span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Stage not available in test.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Wrong input format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span> <span class="ow">and</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">start</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;failure&#39;</span><span class="p">,</span> <span class="s1">&#39;safety incremental&#39;</span><span class="p">,</span> <span class="s1">&#39;safety target&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Failure and safety tests cannot be used as start configurations.&#39;</span><span class="p">)</span>
                <span class="n">phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">start</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">phaseid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Requested start phase or test &lt;</span><span class="si">{}</span><span class="s1">&gt; not available.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">testid</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">phaseid</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">testid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Requested start test &lt;</span><span class="si">{}</span><span class="s1">&gt; not available.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;failure&#39;</span><span class="p">,</span> <span class="s1">&#39;safety incremental&#39;</span><span class="p">,</span> <span class="s1">&#39;safety target&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Failure and safety tests cannot be used as start configurations.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phaseid</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;A stage within a test must be specified by its number as an integer.&#39;</span><span class="p">)</span>
            <span class="n">phaseid</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_stage_</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phaseid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Requested start stage &lt;</span><span class="si">{}</span><span class="s1">&gt; not available in test &lt;</span><span class="si">{}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phaseid</span><span class="p">,</span> <span class="n">testid</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">phaseid</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Test start phase must be specified as a test id string, or a tuple (test id, stage number).&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_surface_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">delete_phases</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcualtes the surface load stage.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        qsurf : numeric, None</span>
<span class="sd">            Surface load.</span>
<span class="sd">        start_phaseid : str</span>
<span class="sd">            Id of the test start phase.</span>
<span class="sd">        delete_phases : bool, optional</span>
<span class="sd">            Deletes test phases from model if there is a calculation</span>
<span class="sd">            error, by default True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Id of the test start phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">qsurf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">start_phaseid</span>
        <span class="n">phaseid</span> <span class="o">=</span> <span class="n">testid</span> <span class="o">+</span> <span class="s1">&#39;_qsurf&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">start_phaseid</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="n">phaseid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_surface_load</span><span class="p">(</span><span class="n">qsurf</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_phase_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">delete_phases</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_phase_results</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">phaseid</span>

    <span class="k">def</span> <span class="nf">_calculate_load_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">ratchetting</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes a phase in a load test.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id</span>
<span class="sd">        prevphaseid : str</span>
<span class="sd">            Id of the previous phase.</span>
<span class="sd">        load : numeric</span>
<span class="sd">            Load value at the end of the phase [kN].</span>
<span class="sd">        ratchetting : bool</span>
<span class="sd">            Flag indicating that ratchetting has alredy occured in any</span>
<span class="sd">            previous phase.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Calculation status, &#39;OK&#39; or error message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">prevphaseid</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="n">phaseid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_ratchetting_material</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">ratchetting</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_load</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_dynamic_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets dynamic load.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_calculate_dynamic_load_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcualtes a dynamic load phase.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_dynamic_load_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds dynamic load values to results dataframe.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets load value in the current phase.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        load : float, array-like</span>
<span class="sd">            (3,) Fy, Fx and M [kN]. If float, the value is assuemd to be</span>
<span class="sd">            Fy and Fx and M are set to 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_surface_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activates and sets a value to the surface load in the</span>
<span class="sd">        curernt phase. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qsurf : numeric</span>
<span class="sd">            Surface load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_update_ratchetting_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">ratchetting</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the ratchetting material under the base if ratchetting</span>
<span class="sd">        occured in the previous phase.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        ratchetting : bool</span>
<span class="sd">            Flag indicating that ratchetting has alredy occured in any</span>
<span class="sd">            previous phase.</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id</span>
<span class="sd">        prevphaseid : str</span>
<span class="sd">            Id of the previous phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ratchetting</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span><span class="p">)</span> \
              <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">phaseid</span><span class="p">)</span> \
              <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">prevphaseid</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ratchetting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()):</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">poly_idxs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">poly_idx</span> <span class="ow">in</span> <span class="n">poly_idxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_soil_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="p">,</span> <span class="n">poly_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span><span class="o">.</span><span class="n">Number</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;ratchetting&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_phase_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">delete_phases</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks calculation status.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        status : str</span>
<span class="sd">            Calculation status, &#39;OK&#39; or error message.</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id</span>
<span class="sd">        delete_phases : bool, optional</span>
<span class="sd">            Deletes test phases from model if there is a calculation</span>
<span class="sd">            error, by default True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Calculation failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_test</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">delete_phases</span><span class="o">=</span><span class="n">delete_phases</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">status</span> <span class="o">+</span> <span class="s1">&#39; &lt;</span><span class="si">{}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phaseid</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">_check_ratchetting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">ratchetting</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if ratchetting occurred in a calculation phase.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id</span>
<span class="sd">        ratchetting : bool</span>
<span class="sd">            Flag indicating that ratchetting has alredy occured in any</span>
<span class="sd">            previous phase.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Bool</span>
<span class="sd">            True if ratchetting occured in the phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ratchetting</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ratchetting</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span><span class="p">)</span> \
              <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">phaseid</span><span class="p">)</span> \
              <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span> \
              <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ratchetting_threshold</span><span class="p">:</span>
            <span class="n">ratchetting</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span><span class="p">)</span> \
                  <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">phaseid</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ratchetting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">ratchetting</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_set_phase_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span><span class="p">,</span> <span class="n">load</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds phase results to the results dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        phaseid : str</span>
<span class="sd">            Phase id</span>
<span class="sd">        prevphaseid : str</span>
<span class="sd">            Id of the previous phase.</span>
<span class="sd">        load : np.ndarray</span>
<span class="sd">            (3,) load applied at the end of the phase (Fy, Fx, M).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="Model.query_yes_no"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.query_yes_no">[docs]</a>    <span class="k">def</span> <span class="nf">query_yes_no</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ask yes/no question, keeps asking until acceptable answer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        question : str</span>
<span class="sd">            Question asked.</span>
<span class="sd">        default : str, optional</span>
<span class="sd">            Default answer value, &quot;yes&quot; or &quot;no. By default &quot;yes&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Answer.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Invalid default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;yes&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;ye&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot; [y/n] &quot;</span>
        <span class="k">elif</span> <span class="n">default</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot; [Y/n] &quot;</span>
        <span class="k">elif</span> <span class="n">default</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot; [y/N] &quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid default answer: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">default</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">question</span> <span class="o">+</span> <span class="n">prompt</span><span class="p">)</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">valid</span><span class="p">[</span><span class="n">default</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">valid</span><span class="p">[</span><span class="n">choice</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Please respond with &#39;yes&#39; or &#39;no&#39; &quot;</span> <span class="s2">&quot;(or &#39;y&#39; or &#39;n&#39;).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
    <span class="c1">#===================================================================</span>
    <span class="c1"># PUBLIC METHODS</span>
    <span class="c1">#===================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculation results.</span>

<span class="sd">        Renturs</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Calculation results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>

<div class="viewcode-block" id="Model.build"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds the model in Plaxis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_geometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_materials</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_surface_load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_mesh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_initial_phases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_output_precalc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_initial_phases</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="Model.regen"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.regen">[docs]</a>    <span class="k">def</span> <span class="nf">regen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_i</span><span class="p">,</span> <span class="n">g_i</span><span class="p">,</span> <span class="n">g_o</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Regenerates the model in Plaxis. Optinoally it recalculates</span>
<span class="sd">        previous load tests.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s_i : Server</span>
<span class="sd">            Plaxis Input Application remote sripting server.</span>
<span class="sd">        g_i : PlxProxyGlobalObject</span>
<span class="sd">            Global object of the current open Plaxis model in Input.</span>
<span class="sd">        g_o : PlxProxyGlobalObject</span>
<span class="sd">            Global object of the current open Plaxis model in Output.</span>
<span class="sd">        test : bool, optional</span>
<span class="sd">            Reclaculate all load tests in Plaxis. By default False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s_i</span> <span class="o">=</span> <span class="n">s_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span> <span class="o">=</span> <span class="n">g_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span> <span class="o">=</span> <span class="n">g_o</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;construction&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;excavation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="o">~</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;construction&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;excavation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">test_log</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">testid</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_log</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;load&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_test</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;load&#39;</span><span class="p">],</span> <span class="n">start_from</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;qsurf&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;failure&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failure_test</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;load&#39;</span><span class="p">],</span>
                                  <span class="n">max_load</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;max_load&#39;</span><span class="p">],</span> <span class="n">start_load</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;start_load&#39;</span><span class="p">],</span>
                                  <span class="n">load_factor</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;load_factor&#39;</span><span class="p">],</span> <span class="n">load_increment</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;load_increment&#39;</span><span class="p">],</span>
                                  <span class="n">start_from</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;qsurf&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;safety incremental&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">safety_test</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">],</span> <span class="n">test</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span> <span class="n">Msf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;Msf&#39;</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;qsurf&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;safety target&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">safety_test</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">],</span> <span class="n">test</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">SumMsf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;SumMsf&#39;</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;qsurf&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_test</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;load&#39;</span><span class="p">],</span> <span class="n">start_from</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;qsurf&#39;</span><span class="p">],</span> <span class="n">nsubstep</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;nsubstep&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shake&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shake_test</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;load&#39;</span><span class="p">],</span> <span class="n">start_from</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;qsurf&#39;</span><span class="p">],</span> <span class="n">nsubstep</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;nsubstep&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Model.save"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves model to file. Plaxis objects cannot be stored, only</span>
<span class="sd">        input properties and results. When loaded, the model can</span>
<span class="sd">        be regenerated with &lt;regen&gt; method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            File name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">question</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;WARNIGN: Saving the load test to memory whipes out the Plaxis &quot;</span>
                    <span class="s2">&quot;objects. Test results and input parameters will still &quot;</span>
                    <span class="s2">&quot;be avaiable, but no further interaction with Plaxis &quot;</span>
                    <span class="s2">&quot;will be possible. The model can be restored with the &quot;</span>
                    <span class="s2">&quot;&lt;regen&gt; method, but load tests will have to be recalculated &quot;</span>
                    <span class="s2">&quot;to access the results whitin Plaxis.</span><span class="se">\n\n</span><span class="s2"> Do you whish to proceed:&quot;</span><span class="p">)</span>
        <span class="n">proceed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_yes_no</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proceed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s_i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_soil_material_plx</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Plaxis objects of the materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plate_material_plx</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Plaxis objects of the materials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure_polygons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure_soil</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_polygons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_waterlevel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_column_plx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_footing_plx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interfaces</span><span class="o">.</span><span class="n">remove_plaxis_objects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_surface_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_point</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.load"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.load">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads saved test.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            File name.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            File does not contain load test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;File &lt;</span><span class="si">{}</span><span class="s1">&gt; does not contain a load test.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">model</span></div>

<div class="viewcode-block" id="Model.load_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.load_test">[docs]</a>    <span class="k">def</span> <span class="nf">load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">start_from</span><span class="o">=</span><span class="s1">&#39;construction&#39;</span><span class="p">,</span> <span class="n">qsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">delete_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Conducts a load test in the model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        load : numeric, array-like</span>
<span class="sd">            (nl, ncomp) Loads applied in each phase of the test [kN].</span>
<span class="sd">            Each load can be an array-like with (Fy, Fx, M) applied to</span>
<span class="sd">            the foundaiton or a numeric value wich is assue as Fy, with</span>
<span class="sd">            Fx and M being zero. Symmetric foundations only allow for</span>
<span class="sd">            vertical loading, thus the load must be a (n1, 1) array or</span>
<span class="sd">            a numeric value. For a single load phase with the 3 load</span>
<span class="sd">            components, the load should be specified as [[Fy, Fx, M]].</span>
<span class="sd">        start_from : str, tuple, optional</span>
<span class="sd">            &#39;construction&#39;, &#39;excavation&#39;, Plaxis phase id or test id</span>
<span class="sd">            used as the start conditions for a new test. If a test with</span>
<span class="sd">            multiple stages is requested, the last test phase is</span>
<span class="sd">            selected. Specific test stages are selected by providing a</span>
<span class="sd">            tuple (test id, stage number), where the phase number is an</span>
<span class="sd">            integer starting from 0. Failure and safety tests cannot be</span>
<span class="sd">            used start configurations. By default &#39;construction&#39;.</span>
<span class="sd">        qsurf : numeric, None, optional</span>
<span class="sd">            Vertical surface load. By default None.</span>
<span class="sd">        delete_fail : bool, optional</span>
<span class="sd">            Deletes test phases from model if there is a calculation</span>
<span class="sd">            error, by default True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Duplicated test id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="n">load</span> <span class="o">=</span> <span class="p">[</span><span class="n">load</span><span class="p">]</span>
        <span class="n">load</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">load</span><span class="p">]</span>
        
        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_start_phase</span><span class="p">(</span><span class="n">start_from</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Duplicated test id &lt;</span><span class="si">{}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;load&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;qsurf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qsurf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">start_phaseid</span><span class="p">)</span>
        
        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_surface_load</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
        
        <span class="n">test_phases</span> <span class="o">=</span> <span class="p">[</span><span class="n">testid</span> <span class="o">+</span> <span class="s1">&#39;_stage_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">load</span><span class="p">))]</span>
        <span class="n">previous_phase</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_phaseid</span><span class="p">]</span> <span class="o">+</span> <span class="n">test_phases</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ratchetting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">load_value</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">test_phases</span><span class="p">,</span> <span class="n">previous_phase</span><span class="p">):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_load_phase</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span><span class="p">,</span>
                                                <span class="n">load_value</span><span class="p">,</span> <span class="n">ratchetting</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_phase_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_phase_results</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">prevphaseid</span><span class="p">,</span> <span class="n">load_value</span><span class="p">)</span>
            <span class="n">ratchetting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ratchetting</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">ratchetting</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Model.failure_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.failure_test">[docs]</a>    <span class="k">def</span> <span class="nf">failure_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">max_load</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
                     <span class="n">load_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">load_increment</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">qsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">start_from</span><span class="o">=</span><span class="s1">&#39;construction&#39;</span><span class="p">,</span> <span class="n">delete_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the foundation until the model does not converge. A</span>
<span class="sd">        first trial is done using the start_load value. If lack of</span>
<span class="sd">        convergence is not achieved, the load is incremented as: </span>

<span class="sd">        load = load_factor * load + load_increment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        load : numeric, array-like, optional</span>
<span class="sd">            (3,) Initial load applied to the model (Fy, Fx, M). Numeric</span>
<span class="sd">            input is assue as Fy , with Fx and M being zeros. Symmetric</span>
<span class="sd">            foundations only allow for vertical loading.</span>
<span class="sd">        max_load : numeric, array-like, optional</span>
<span class="sd">            (3,) maximum load to be applied to the model (Fy, Fx, M) in</span>
<span class="sd">            absolute value. Numeric input is assue as Fy , with Fx and M</span>
<span class="sd">            being infinity. By default [inf, inf, inf].</span>
<span class="sd">        load_factor : numeric, optional</span>
<span class="sd">            Multiplicative factor applied to the previous load when</span>
<span class="sd">            iteration is required. By default 2.</span>
<span class="sd">        load_increment : array-like, optional</span>
<span class="sd">            (3,) load increment applied to the previous load when</span>
<span class="sd">            iteration is required (Fy, Fx, M). By default [0, 0, 0].</span>
<span class="sd">        qsurf : numeric, None, optional</span>
<span class="sd">            Vertical surface load. By default None.</span>
<span class="sd">        start_from : str, tuple, optional</span>
<span class="sd">            &#39;construction&#39;, &#39;excavation&#39;, Plaxis phase id or test id</span>
<span class="sd">            used as the start conditions for a new test. If a test with</span>
<span class="sd">            multiple stages is requested, the last test phase is</span>
<span class="sd">            selected. Specific test stages are selected by providing a</span>
<span class="sd">            tuple (test id, stage number), where the phase number is an</span>
<span class="sd">            integer starting from 0. Failure and safety tests cannot be</span>
<span class="sd">            used start configurations. By default &#39;construction&#39;.</span>
<span class="sd">        delete_fail : bool, optional</span>
<span class="sd">            Deletes surface load phase from model if there is a</span>
<span class="sd">            calculation error, by default True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Duplicated test id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_start_phase</span><span class="p">(</span><span class="n">start_from</span><span class="p">)</span>
        <span class="n">load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_format</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="n">load_increment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_format</span><span class="p">(</span><span class="n">load_increment</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Duplicated test id &lt;</span><span class="si">{}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;failure&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;load_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;load_increment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">load_increment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">start_phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;max_load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;qsurf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qsurf</span>
        

        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_surface_load</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>

        <span class="n">phaseid</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;OK&#39;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_load_phase</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">load</span><span class="p">),</span> <span class="n">max_load</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phases</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">phase</span><span class="o">.</span><span class="n">Identification</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">phaseid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">phaseid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">load</span> <span class="o">=</span> <span class="n">load_factor</span> <span class="o">*</span> <span class="n">load</span> <span class="o">+</span> <span class="n">load_increment</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_load_phase</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="p">[</span><span class="n">phaseid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_phase_results</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.safety_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.safety_test">[docs]</a>    <span class="k">def</span> <span class="nf">safety_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">start_from</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span> <span class="n">SumMsf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">Msf</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">qsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Conducts a safety test on the model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        start_from : str, tuple</span>
<span class="sd">            &#39;construction&#39;, Plaxis phase id or test id used as the start</span>
<span class="sd">            conditions for a new test. If a test with multiple stages is</span>
<span class="sd">            requested, the last test phase is selected. Specific test</span>
<span class="sd">            stages are selected by providing a tuple (test id, stage number),</span>
<span class="sd">            where the phase number is an integer starting from 0.</span>
<span class="sd">            Failure and safety tests cannot be used start</span>
<span class="sd">            configurations.</span>
<span class="sd">        test : str, optional</span>
<span class="sd">            Safety test type: &#39;incremental&#39; or &#39;target&#39;. By default</span>
<span class="sd">            &#39;incremental&#39;.</span>
<span class="sd">        SumMsf : float, optional</span>
<span class="sd">            Strength reduction factor target value in a target test. By</span>
<span class="sd">            default None.</span>
<span class="sd">        Msf : float, optional</span>
<span class="sd">            Strength reduction factor ncrement in an incremental test.</span>
<span class="sd">            By default 0.1.</span>
<span class="sd">        qsurf : numeric, None, optional</span>
<span class="sd">            Vertical surface load. By default None.</span>
<span class="sd">        delete_fail : bool, optional</span>
<span class="sd">            Deletes surface load phase from model if there is a</span>
<span class="sd">            calculation error, by default True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Duplicated test id</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Unsuported test type.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            SumMsf wrong type.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            SumMsf wrong type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_start_phase</span><span class="p">(</span><span class="n">start_from</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">testid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Duplicated test id &lt;</span><span class="si">{}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">test</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Supported test types are &#39;incremental&#39; and &#39;target&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;safety &#39;</span> <span class="o">+</span> <span class="n">test</span>
        <span class="k">if</span> <span class="n">test</span> <span class="o">==</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SumMsf</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;A numeric value must be provided for the target Msf &lt;SumMsf&gt;.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;SumMsf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SumMsf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Msf</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;A numeric value must be provided for the Msf increase &lt;Msf&gt;.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;Msf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Msf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">start_phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;qsurf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qsurf</span>
        

        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_surface_load</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">start_phaseid</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span><span class="o">.</span><span class="n">Identification</span> <span class="o">=</span> <span class="n">testid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">DeformCalcType</span><span class="p">,</span> <span class="s2">&quot;Safety&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">MaxStepsStored</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test</span> <span class="o">==</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">LoadingType</span><span class="p">,</span> <span class="s2">&quot;Target SumMsf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">Loading</span><span class="o">.</span><span class="n">SumMsf</span><span class="p">,</span> <span class="n">SumMsf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">LoadingType</span><span class="p">,</span> <span class="s2">&quot;Incremental multipliers&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="o">.</span><span class="n">Deform</span><span class="o">.</span><span class="n">Loading</span><span class="o">.</span><span class="n">Msf</span><span class="p">,</span> <span class="n">Msf</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_phase_results</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_phase_load</span><span class="p">(</span><span class="n">start_phaseid</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="Model.dynamic_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.dynamic_test">[docs]</a>    <span class="k">def</span> <span class="nf">dynamic_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">start_from</span><span class="o">=</span><span class="s1">&#39;construction&#39;</span><span class="p">,</span>
                     <span class="n">nsubstep</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">qsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a dynamic load to the foundation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        time : array-like</span>
<span class="sd">            (nt,) time array.</span>
<span class="sd">        load : array-like</span>
<span class="sd">            (ncomp, nt) force array (Fy, Fx) for solid models or</span>
<span class="sd">            (Fx, Fy, M) for plate models.. If only Fy is provided, the</span>
<span class="sd">            other components are assumed as 0.</span>
<span class="sd">        start_from : str, tuple, optional</span>
<span class="sd">            &#39;construction&#39;, &#39;excavation&#39;, Plaxis phase id or test id</span>
<span class="sd">            used as the start conditions for a new test. If a test with</span>
<span class="sd">            multiple stages is requested, the last test phase is</span>
<span class="sd">            selected. Specific test stages are selected by providing a</span>
<span class="sd">            tuple (test id, stage number), where the phase number is an</span>
<span class="sd">            integer starting from 0. Failure and safety tests cannot be</span>
<span class="sd">            used start configurations. By default &#39;construction&#39;.</span>
<span class="sd">        nsubstep : int, optional</span>
<span class="sd">            Substests in each time step, by default 10.</span>
<span class="sd">        qsurf : numeric, None, optional</span>
<span class="sd">            Vertical surface load. By default None.</span>
<span class="sd">        delete_fail : bool, optional</span>
<span class="sd">            Deletes test phases from model if there is a calculation</span>
<span class="sd">            error, by default True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Duplicated test id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_start_phase</span><span class="p">(</span><span class="n">start_from</span><span class="p">)</span>
        <span class="n">time</span><span class="p">,</span> <span class="n">input_load</span><span class="p">,</span> <span class="n">load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_dynamic_load</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">testid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Duplicated test id &lt;</span><span class="si">{}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dynamic&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;nsubstep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nsubstep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">start_phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;qsurf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qsurf</span>

        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_surface_load</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_dynamic_test_phase</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">nsubstep</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_dynamic_load_phase</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_phase_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_phase_results</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_dynamic_load_result</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">load</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.shake_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.shake_test">[docs]</a>    <span class="k">def</span> <span class="nf">shake_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">,</span> <span class="n">start_from</span><span class="o">=</span><span class="s1">&#39;construction&#39;</span><span class="p">,</span>
                   <span class="n">qsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nsubstep</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">delete_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a displacement time history at the model base.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        time : array-like</span>
<span class="sd">            (nt,) time array.</span>
<span class="sd">        acceleration : array-like</span>
<span class="sd">            (ncomp, nt) displacement time history (ux, uy). If a 1D</span>
<span class="sd">            array (nt,) is provided it is adopted as ux and is assumed</span>
<span class="sd">            that uy = 0.</span>
<span class="sd">        start_from : str, tuple, optional</span>
<span class="sd">            &#39;construction&#39;, &#39;excavation&#39;, Plaxis phase id or test id</span>
<span class="sd">            used as the start conditions for a new test. If a test with</span>
<span class="sd">            multiple stages is requested, the last test phase is</span>
<span class="sd">            selected. Specific test stages are selected by providing a</span>
<span class="sd">            tuple (test id, stage number), where the phase number is an</span>
<span class="sd">            integer starting from 0. Failure and safety tests cannot be</span>
<span class="sd">            used start configurations. By default &#39;construction&#39;.</span>
<span class="sd">        nsubstep : int, optional</span>
<span class="sd">            Substests in each time step, by default 10.</span>
<span class="sd">        qsurf : numeric, None, optional</span>
<span class="sd">            Vertical surface load. By default None.</span>
<span class="sd">        delete_fail : bool, optional</span>
<span class="sd">            Deletes test phases from model if there is a calculation</span>
<span class="sd">            error, by default True.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Model lacks boundary interfaces.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Duplicated test id.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Time is not 1-dimensional.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            More than 10,000 time steps.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Length of base displacement array does not match the time</span>
<span class="sd">            array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_interface_flag</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Boundary interfaces must be included in the model, set &quot;</span>
                   <span class="s2">&quot;the &lt;boundary_interface&gt; parameter to True at the model creation.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">testid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Duplicated test id &lt;</span><span class="si">{}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Time must be defined by a 1-dimensional array.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Number of time steps must be &lt;=10,000.&#39;</span><span class="p">)</span>
        
        <span class="n">acceleration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acceleration</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">acceleration</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">acceleration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">acceleration</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">acceleration</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">acceleration</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Base acceleration and time arrays must have the same length.&#39;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_start_phase</span><span class="p">(</span><span class="n">start_from</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">testid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;shake&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">acceleration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;nsubstep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nsubstep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;start phaseid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">start_phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;qsurf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qsurf</span>

        <span class="n">start_phaseid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_surface_load</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">qsurf</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_dynamic_test_phase</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="n">nsubstep</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        
        <span class="n">accel_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">displmultiplier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_x</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span> <span class="s2">&quot;Table&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_x</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span> <span class="s2">&quot;Accelerations&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">accel</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">accel_x</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_x</span><span class="o">.</span><span class="n">Table</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_x</span><span class="o">.</span><span class="n">Table</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Multiplier</span><span class="p">,</span> <span class="n">accel</span><span class="p">)</span>
        
        <span class="n">accel_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">displmultiplier</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_y</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span> <span class="s2">&quot;Table&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_y</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span> <span class="s2">&quot;Accelerations&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">accel</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="n">accel_y</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_y</span><span class="o">.</span><span class="n">Table</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accel_y</span><span class="o">.</span><span class="n">Table</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Multiplier</span><span class="p">,</span> <span class="n">accel</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">DynLineDisplacement_1_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">DynLineDisplacement_1_1</span><span class="o">.</span><span class="n">Multiplierx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="n">accel_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">DynLineDisplacement_1_1</span><span class="o">.</span><span class="n">Multipliery</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="n">accel_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_1</span><span class="o">.</span><span class="n">Displacement_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="s2">&quot;Prescribed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_1</span><span class="o">.</span><span class="n">Displacement_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="s2">&quot;Prescribed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_1</span><span class="o">.</span><span class="n">ux_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_1</span><span class="o">.</span><span class="n">uy_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">DynLineDisplacement_1_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">DynLineDisplacement_1_2</span><span class="o">.</span><span class="n">Multiplierx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="n">accel_x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">DynLineDisplacement_1_2</span><span class="o">.</span><span class="n">Multipliery</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="n">accel_y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_2</span><span class="o">.</span><span class="n">Displacement_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="s2">&quot;Prescribed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_2</span><span class="o">.</span><span class="n">Displacement_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="s2">&quot;Prescribed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_2</span><span class="o">.</span><span class="n">ux_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">LineDisplacement_1_2</span><span class="o">.</span><span class="n">uy_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">CurrentPhase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_phase_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">delete_fail</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_phase_results</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">start_phaseid</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_point</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">loc</span><span class="p">)</span>
            <span class="n">result_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;agx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">result_time</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">result_time</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">acceleration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="Model.delete_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.delete_test">[docs]</a>    <span class="k">def</span> <span class="nf">delete_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">delete_phases</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes a test from the model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        delete_phases : bool, optional</span>
<span class="sd">            Deletes test phases from model, by default True</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Test not present in model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">testid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Test &lt;</span><span class="si">{}</span><span class="s1">&gt; not in results&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">test_phases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">testid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_phases</span><span class="p">:</span>
            <span class="n">test_phases</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">phaseid</span> <span class="ow">in</span> <span class="n">test_phases</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">phases</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">phase</span><span class="o">.</span><span class="n">Identification</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">phaseid</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_g_i</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span><span class="o">.</span><span class="n">phases</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">phase</span><span class="o">.</span><span class="n">Identification</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">phaseid</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_g_o</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="n">test_phases</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">phaseid</span> <span class="ow">in</span> <span class="n">test_phases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">phaseid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iphases</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">phaseid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phaseid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ophases</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">phaseid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">testid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.plot_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.plot_test">[docs]</a>    <span class="k">def</span> <span class="nf">plot_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">compression_positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pullout_positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">reset_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots test results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        force : str, list, None, optional</span>
<span class="sd">            Force components to plot: &#39;Fy&#39;, &#39;Fx&#39;, &#39;M&#39;. If None, default</span>
<span class="sd">            settings based on foundation type are adopted.</span>
<span class="sd">        displacement : str, list, None, optional</span>
<span class="sd">            Displacement components to plot: &#39;ux&#39;, &#39;uy&#39;. If None,</span>
<span class="sd">            default settings based on foundation type are adopted.</span>
<span class="sd">        phase : str, int, list, None, optional</span>
<span class="sd">            Phase id or list of them. If None all phases are plotted.</span>
<span class="sd">            By default None.</span>
<span class="sd">        location : str, float, optional</span>
<span class="sd">            Location. If None all locations are plotted. By default </span>
<span class="sd">            None.</span>
<span class="sd">        compression_positive : bool, optional</span>
<span class="sd">            Compresive force is plotted as positive. By default True.</span>
<span class="sd">        pullout_positive : bool, optional</span>
<span class="sd">            Pull out displacement is plotted as positive. By default</span>
<span class="sd">            False.</span>
<span class="sd">        reset_start : bool, optional</span>
<span class="sd">            Resets the first point of the load-displacement curve to</span>
<span class="sd">            (0, 0). By default False</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Shows legend. By default False</span>
<span class="sd">        xlim : array-like, dict, None, optional</span>
<span class="sd">            If (2,) array then it is applied as the x axis limits to </span>
<span class="sd">            all plots. Dictiornay with keys &#39;ux&#39; and &#39;uy&#39; with</span>
<span class="sd">            the desired limits for each displacement component. By</span>
<span class="sd">            default None.</span>
<span class="sd">        ylim : array-like, dict, None, optional</span>
<span class="sd">            If (2,) array then it is applied as the y axis limits to </span>
<span class="sd">            all plots. Dictiornay with keys &#39;Fx&#39;, &#39;Fy&#39; and &#39;M&#39; with</span>
<span class="sd">            the desired limits for each force component. By default</span>
<span class="sd">            None.</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            Figure size of a single plot. By default (4, 3).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Figure</span>
<span class="sd">            Figure with the test plot.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid force component.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid displacement component.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Test id not in restuls.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Phase not in results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="s1">&#39;Fy&#39;</span>
        <span class="k">elif</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">force</span> <span class="o">=</span> <span class="p">[</span><span class="n">force</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">force</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Invalid force component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are &quot;</span>
                    <span class="s2">&quot;&#39;Fy&#39;, &#39;Fx&#39; and &#39;M&#39;.&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="s1">&#39;uy&#39;</span>
        <span class="k">elif</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;ux&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="n">displacement</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">displacement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid displacement component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are &#39;ux&#39; and &#39;uy&#39;.&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;planestrain&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="s1">&#39;H [kN/m]&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span> <span class="s1">&#39;V [kN/m]&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="s1">&#39;M [kN/m/m]&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="s1">&#39;H [kN]&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span> <span class="s1">&#39;V [kN]&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="s1">&#39;M [kN/m]&#39;</span><span class="p">}</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span> <span class="s1">&#39;ux [cm]&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span> <span class="s1">&#39;uy [cm]&#39;</span><span class="p">}</span>

        <span class="n">x_lim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x_lim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">xlim</span><span class="p">:</span>
                    <span class="n">x_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">x_lim</span><span class="p">:</span>
                <span class="n">x_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlim</span>

        <span class="n">y_lim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylim</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ylim</span><span class="p">:</span>
                    <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span>

        <span class="k">if</span> <span class="n">testid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Test &lt;</span><span class="si">{}</span><span class="s1">&gt; not available in restuls.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span>

        <span class="k">if</span> <span class="n">phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="p">[</span><span class="n">phase</span><span class="p">]</span>
        <span class="n">phase_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phase</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">pidx</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
                <span class="n">phase</span><span class="p">[</span><span class="n">pidx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_stage_</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">,</span> <span class="n">phase</span><span class="p">[</span><span class="n">pidx</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">phase</span><span class="p">[</span><span class="n">pidx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Phase &lt;</span><span class="si">{}</span><span class="s1">&gt; not available in test &lt;</span><span class="si">{}</span><span class="s1">&gt; not available in restuls&#39;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">pidx</span><span class="p">],</span> <span class="n">testid</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">phase</span><span class="p">[</span><span class="n">pidx</span><span class="p">])</span>
            <span class="n">phase_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx2</span><span class="p">][</span><span class="s1">&#39;plx id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">6</span><span class="p">:]))</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">phase_order</span><span class="p">,</span> <span class="n">phase</span><span class="p">))]</span>

        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="n">location</span><span class="p">]</span>

        <span class="n">fsign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Fy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">dsign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">compression_positive</span><span class="p">:</span>
            <span class="n">fsign</span><span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pullout_positive</span><span class="p">:</span>
            <span class="n">dsign</span><span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">]</span> <span class="o">=-</span> <span class="mi">1</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">nd</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nd</span><span class="p">,</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">nf</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nd</span> <span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">axes</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">nd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">nf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idxf</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">force</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idxd</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">displacement</span><span class="p">):</span> 
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idxf</span><span class="p">,</span> <span class="n">idxd</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">location</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">phaseid</span> <span class="ow">in</span> <span class="n">phase</span><span class="p">:</span>
                        <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">phaseid</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">loc</span><span class="p">)</span>
                        <span class="n">u0</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">reset_start</span><span class="p">:</span>
                            <span class="n">u0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dsign</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="n">u0</span><span class="p">)</span>  <span class="o">*</span><span class="mi">100</span><span class="p">,</span>
                                <span class="n">fsign</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">f</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">phaseid</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">idxd</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">idxf</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>
    
<div class="viewcode-block" id="Model.plot_safety_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.plot_safety_test">[docs]</a>    <span class="k">def</span> <span class="nf">plot_safety_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span>  <span class="n">displacement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pullout_positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">reset_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots safety test</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        displacement : str, list, None, optional</span>
<span class="sd">            Displacement components to plot: &#39;ux&#39;, &#39;uy&#39;. If None,</span>
<span class="sd">            default settings based on foundation type is adopted.</span>
<span class="sd">        location : str, float, optional</span>
<span class="sd">            Location. If None all locations are plotted. By default </span>
<span class="sd">            None.</span>
<span class="sd">        pullout_positive : bool, optional</span>
<span class="sd">            Pull out displacement is plotted as positive. By default</span>
<span class="sd">            False.</span>
<span class="sd">        reset_start : bool, optional</span>
<span class="sd">            Resets the first point of the load-displacement curve to</span>
<span class="sd">            (0, 0). By default False</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Shows legend. By default False</span>
<span class="sd">        xlim : array-like</span>
<span class="sd">            Limit of the vertical axis of the plot.</span>
<span class="sd">        ylim : array-like, dict, None, optional</span>
<span class="sd">            If (2,) array then it is applied as the y axis limits to </span>
<span class="sd">            all plots. Dictiornay with keys &#39;ux&#39; and &#39;uy&#39; with</span>
<span class="sd">            the desired limits for each displacement component. By</span>
<span class="sd">            default None.</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            Figure size. By default (6, 4).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Figure</span>
<span class="sd">            Figure with the safety test plot.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid displacement component.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Test id not in restuls.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Non safety test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="s1">&#39;uy&#39;</span>
        <span class="k">elif</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;ux&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="n">displacement</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">displacement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid displacement component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are &#39;ux&#39; and &#39;uy&#39;.&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>

        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span> <span class="s1">&#39;ux [cm]&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span> <span class="s1">&#39;uy [cm]&#39;</span><span class="p">}</span>

        <span class="n">y_lim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">xlim</span><span class="p">:</span>
                    <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span>

        <span class="k">if</span> <span class="n">testid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Test &lt;</span><span class="si">{}</span><span class="s1">&gt; not available in restuls.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testid</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_log</span><span class="p">[</span><span class="n">testid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;safety incremental&#39;</span><span class="p">,</span> <span class="s1">&#39;safety target&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Only safety tests can be plotted.&#39;</span><span class="p">)</span>
        
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span>

        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="n">location</span><span class="p">]</span>

        <span class="n">dsign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">pullout_positive</span><span class="p">:</span>
            <span class="n">dsign</span><span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">]</span> <span class="o">=-</span> <span class="mi">1</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nd</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">nd</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">idxd</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">displacement</span><span class="p">):</span> 
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idxd</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">location</span><span class="p">:</span>
                <span class="n">idx2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">testid</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">u0</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">reset_start</span><span class="p">:</span>
                    <span class="n">u0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;SumMsf&#39;</span><span class="p">],</span> 
                        <span class="n">dsign</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="n">u0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\sum$Msf [ ]&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Model.plot_dynamic_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.plot_dynamic_test">[docs]</a>    <span class="k">def</span> <span class="nf">plot_dynamic_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compression_positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">pullout_positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot dynamic test resutls versus time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        displacement : str, list, None, optional</span>
<span class="sd">            Displacement components to plot: &#39;ux&#39;, &#39;uy&#39;. If None,</span>
<span class="sd">            default settings based on foundation type are adopted.</span>
<span class="sd">        force : str, list, None, optional</span>
<span class="sd">            Force components to plot: &#39;Fy&#39;, &#39;Fx&#39;, &#39;M&#39;. If None, default</span>
<span class="sd">            settings based on foundation type are adopted.</span>
<span class="sd">        location : str, float, optional</span>
<span class="sd">            Location. If None all locations are plotted. By default </span>
<span class="sd">            None.</span>
<span class="sd">        compression_positive : bool, optional</span>
<span class="sd">            Compresive force is plotted as positive. By default True.</span>
<span class="sd">        pullout_positive : bool, optional</span>
<span class="sd">            Pull out displacement is plotted as positive. By default</span>
<span class="sd">            False.</span>
<span class="sd">        xlim : array-like, None, optional</span>
<span class="sd">            (2,) limits of x axis. By default None.</span>
<span class="sd">        ylim : array-like, dict, None, optional</span>
<span class="sd">            If (2,) array then it is applied as the y axis limits to </span>
<span class="sd">            all plots. Dictiornay with keys &#39;ux&#39;, &#39;uy&#39;, &#39;Fx&#39;, &#39;Fy&#39; and</span>
<span class="sd">            &#39;M&#39; with the desired limits for each variable. By default</span>
<span class="sd">            None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Shows legend. By default False</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            Figure size of a single plot. By default (8, 2).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Figure</span>
<span class="sd">            Figure with the test plot.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid displacement component.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid force component.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="s1">&#39;uy&#39;</span>
        <span class="k">elif</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;ux&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="n">displacement</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">displacement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid displacement component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are &#39;ux&#39; and &#39;uy&#39;.&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="s1">&#39;Fy&#39;</span>
        <span class="k">elif</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_foundation_type</span> <span class="o">==</span> <span class="s1">&#39;plate&#39;</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">force</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">force</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">force</span> <span class="o">=</span> <span class="p">[</span><span class="n">force</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_foundation_type</span> <span class="o">==</span> <span class="s1">&#39;plate&#39;</span><span class="p">:</span>
            <span class="n">valid_forces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_forces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">force</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_forces</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid force component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are </span><span class="si">{}</span><span class="s2">.&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_forces</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>        

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="n">location</span><span class="p">]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_type</span> <span class="o">==</span> <span class="s1">&#39;planestrain&#39;</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="s1">&#39;H [kN/m]&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span> <span class="s1">&#39;V [kN/m]&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="s1">&#39;M [kN/m/m]&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="s1">&#39;H [kN]&#39;</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span> <span class="s1">&#39;V [kN]&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="s1">&#39;M [kN/m]&#39;</span><span class="p">}</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">axis_label</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span> <span class="s1">&#39;ux [cm]&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span> <span class="s1">&#39;uy [cm]&#39;</span><span class="p">}}</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pullout_positive</span><span class="p">:</span>
            <span class="n">sign</span><span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">compression_positive</span><span class="p">:</span>
            <span class="n">sign</span><span class="p">[</span><span class="s1">&#39;Fy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            
        <span class="n">y_lim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Fx&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Fy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylim</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ylim</span><span class="p">:</span>
                    <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span>
        
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nd</span> <span class="o">+</span> <span class="n">nf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nd</span> <span class="o">+</span> <span class="n">nf</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">displacement</span> <span class="o">+</span> <span class="n">force</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">valid_forces</span><span class="p">:</span>
                <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">sign</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">location</span><span class="p">:</span>
                    <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">loc</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">sign</span><span class="p">[</span><span class="n">var</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Model.plot_shake_test"><a class="viewcode-back" href="../../../padtest.model.html#padtest.model.model.Model.plot_shake_test">[docs]</a>    <span class="k">def</span> <span class="nf">plot_shake_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testid</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acceleration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pullout_positive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot shake test results versus time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        testid : str</span>
<span class="sd">            Test id.</span>
<span class="sd">        displacement : str, list, None, optional</span>
<span class="sd">            Displacement components to plot: &#39;ux&#39;, &#39;uy&#39;. If None,</span>
<span class="sd">            default settings based on foundation type is adopted.</span>
<span class="sd">        acceleration : str, list, None, optional</span>
<span class="sd">            Base acceleration components to plot: &#39;agx&#39;, &#39;agy&#39;. If None</span>
<span class="sd">            both are plotted. By default None.</span>
<span class="sd">        location : str, float, optional</span>
<span class="sd">            Location. If None all locations are plotted. By default </span>
<span class="sd">            None.</span>
<span class="sd">        pullout_positive : bool, optional</span>
<span class="sd">            Pull out displacement is plotted as positive. By default</span>
<span class="sd">            False.</span>
<span class="sd">        xlim : array-like, None, optional</span>
<span class="sd">            (2,) limits of x axis. By default None.</span>
<span class="sd">        ylim : array-like, dict, None, optional</span>
<span class="sd">            If (2,) array then it is applied as the y axis limits to </span>
<span class="sd">            all plots. Dictiornay with keys &#39;ux&#39;, &#39;uy&#39;, &#39;agx&#39; and &#39;agy&#39;</span>
<span class="sd">            with the desired limits for each variable. By default</span>
<span class="sd">            None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Shows legend. By default False</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            Figure size of a single plot. By default (4, 3).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Figure</span>
<span class="sd">            Figure with the test plot.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid displacement component.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Invalid bace acceleration component.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symmetric</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="s1">&#39;uy&#39;</span>
        <span class="k">elif</span> <span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;ux&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">displacement</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="p">[</span><span class="n">displacement</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">displacement</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid displacement component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are &#39;ux&#39; and &#39;uy&#39;.&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">acceleration</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">acceleration</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;agx&#39;</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">acceleration</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">acceleration</span> <span class="o">=</span> <span class="p">[</span><span class="n">acceleration</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acceleration</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;agx&#39;</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">]:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid base acceleration component &lt;</span><span class="si">{}</span><span class="s2">&gt;. Supported values are &#39;agx&#39; and &#39;agy&#39;.&quot;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">na</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">acceleration</span><span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">testid</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)):</span>
            <span class="n">location</span> <span class="o">=</span> <span class="p">[</span><span class="n">location</span><span class="p">]</span>

        <span class="n">axis_label</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span> <span class="s1">&#39;ux [cm]&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span> <span class="s1">&#39;uy [cm]&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;agx&#39;</span><span class="p">:</span> <span class="s2">&quot;base horizontal</span><span class="se">\n</span><span class="s2">acceleration [m/s/s]&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;agy&#39;</span><span class="p">:</span> <span class="s2">&quot;base vertical</span><span class="se">\n</span><span class="s2">acceleration [m/s/s]&quot;</span><span class="p">}</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;agx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;agx&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pullout_positive</span><span class="p">:</span>
            <span class="n">sign</span><span class="p">[</span><span class="s1">&#39;uy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">y_lim</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ux&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;agx&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylim</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ylim</span><span class="p">:</span>
                    <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">y_lim</span><span class="p">:</span>
                <span class="n">y_lim</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nd</span> <span class="o">+</span> <span class="n">na</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nd</span> <span class="o">+</span> <span class="n">na</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">displacement</span> <span class="o">+</span> <span class="n">acceleration</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;agx&#39;</span><span class="p">,</span> <span class="s1">&#39;agy&#39;</span><span class="p">]:</span>
                <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">sign</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">location</span><span class="p">:</span>
                    <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">loc</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx2</span><span class="p">,</span> <span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">sign</span><span class="p">[</span><span class="n">var</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Pablo Barbieri.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>